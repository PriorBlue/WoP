var ws = require( 'websocket.io' );var _ = require( 'lodash' );var server = ws.listen( 3000 );var connections = [];var addNewPlayer = function ( connection ) {	var player = {		connection: connection,		money     : 20000,		wares     : [],		buildings : []	};	connections.push( player );	var response = {		event: 'init',		data : _.omit( playeplayer, 'connection' )	};	connection.send(response);};var sendToAll = function ( message ) {	connections.forEach( function ( client ) {		client.connection.send( message );	} )};server.on( 'connection', function ( client ) {	addNewPlayer();	client.on( 'message', function ( a ) {		var buf = new Buffer( a );		console.log( buf.toString() );		var response = {			item: {				name : 'asd',				price: '213',				stock: 100,				list : [					{ listname: 'one' },					{ listname: 'one' }				]			}		};		client.send( JSON.stringify( response ) );	} );	client.on( 'close', function () {		console.log( 'client left' );	} );} );